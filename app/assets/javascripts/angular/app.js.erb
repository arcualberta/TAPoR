'use strict';

var app = angular.module("taporApp", ["ngResource", "ngRoute", "selectize", "ui.sortable"]);

app.config(['$httpProvider', function($httpProvider){
  $httpProvider.defaults.headers.common['X-CSRF-Token'] = $('meta[name=csrf-token]').attr('content');
}]);


app.config(['$routeProvider', '$locationProvider',
  function($routeProvider,  $locationProvider) {
    $locationProvider.html5Mode(true);


    $routeProvider
      .when('/', {
        templateUrl: "<%= asset_path('tapor/index.html') %>",        
        redirectTo: function(current, path, query){
          if(query.goto){
          // if we were passed in a query param, and it has a path
          // to redirect to, then redirect to that path
            return "/" + query.goto;
          }
        }
      })
      .when('/signin', {
        templateUrl: "<%= asset_path('tapor/signin.html') %>",
      })
      .when('/sign_out', {
        templateUrl: "<%= asset_path('tapor/index.html') %>",
        redirectTo: function(current, path, query) {
          window.location= '/sign_out';
        }
      })
      .when('/users/auth/google_oauth2', {
        // Change to loading
        templateUrl: "<%= asset_path('tapor/loading.html') %>",
        redirectTo: function(current, path, query) {
          window.location= '/users/auth/google_oauth2';
        }
      })
      .when('/users/auth/twitter', {
        // Change to loading
        templateUrl: "<%= asset_path('tapor/loading.html') %>",
        redirectTo: function(current, path, query) {
          window.location= '/users/auth/twitter';
        }
      })
      .when('/users/auth/yahoo', {
        // Change to loading
        templateUrl: "<%= asset_path('tapor/loading.html') %>",
        redirectTo: function(current, path, query) {
          window.location= '/users/auth/yahoo';
        }
      })
      // Tools
      .when('/tools', {
        templateUrl: "<%= asset_path('tools/index.html') %>",
      })
      .when('/tools/new', {
        templateUrl: "<%= asset_path('tools/edit.html') %>",
      })
      .when('/tools/edit/:id', {
        templateUrl: "<%= asset_path('tools/edit.html') %>",
      })
      .when('/tools/featured', {
        templateUrl: "<%= asset_path('tools/featured.html') %>",
      })
      .when('/tools/:id', {
        templateUrl: "<%= asset_path('tools/detail.html') %>",
      })
      // Users
      .when('/users', {
        templateUrl: "<%= asset_path('users/index.html') %>",
      })
      .when('/users/profile', {
        templateUrl: "<%= asset_path('users/detail.html') %>",
      })
      // Attributes
      .when('/attributes', {
        templateUrl: "<%= asset_path('attributes/index.html') %>",
      })
      .when('/attributes/new', {
        templateUrl: "<%= asset_path('attributes/new.html') %>",
      })
      // Lists
      // .when('/lists', {
      //   templateUrl: "<%= asset_path('lists/public.html') %>",
      //   controller: 'ListsPublicCtrl'
      // })

      .when('/tool_lists/contributing', {
        templateUrl: "<%= asset_path('tool_lists/contributing.html') %>",
      })
      .when('/tool_lists/new', {
        templateUrl: "<%= asset_path('tool_lists/edit.html') %>",
      })
      .when('/tool_lists/edit/:id', {
        templateUrl: "<%= asset_path('tool_lists/edit.html') %>",
      })
      .when('/tool_lists/:id', {
        templateUrl: "<%= asset_path('tool_lists/detail.html') %>",
      })
  }]);


