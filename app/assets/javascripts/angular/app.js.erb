'use strict';

var app = angular.module("taporApp", ["ngResource", "ngRoute"]);

app.config(['$httpProvider', function($httpProvider){
  $httpProvider.defaults.headers.common['X-CSRF-Token'] = $('meta[name=csrf-token]').attr('content');
}]);


app.config(['$routeProvider', '$locationProvider',
  function($routeProvider,  $locationProvider) {
    $locationProvider.html5Mode(true);


    $routeProvider
      .when('/', {
        templateUrl: "<%= asset_path('tapor/index.html') %>",
        controller: 'TaporIndexCtrl',
        redirectTo: function(current, path, query){
          if(query.goto){
          // if we were passed in a query param, and it has a path
          // to redirect to, then redirect to that path
            return "/" + query.goto;
          }
        }
      })
      .when('/signin', {
        templateUrl: "<%= asset_path('tapor/signin.html') %>",
        // controller: 'SigninIndexCtrl'
      })
      .when('/sign_out', {
        templateUrl: "<%= asset_path('tapor/index.html') %>",
        controller: 'TaporIndexCtrl',
        redirectTo: function(current, path, query) {
          window.location= '/sign_out';
        }
      })
      .when('/users/auth/google_oauth2', {
        // Change to loading
        templateUrl: "<%= asset_path('tapor/loading.html') %>",
        // controller: 'TaporIndexCtrl',
        redirectTo: function(current, path, query) {
          window.location= '/users/auth/google_oauth2';
        }
      })
      .when('/users/auth/twitter', {
        // Change to loading
        templateUrl: "<%= asset_path('tapor/loading.html') %>",
        // controller: 'TaporIndexCtrl',
        redirectTo: function(current, path, query) {
          window.location= '/users/auth/twitter';
        }
      })
      .when('/users/auth/yahoo', {
        // Change to loading
        templateUrl: "<%= asset_path('tapor/loading.html') %>",
        // controller: 'TaporIndexCtrl',
        redirectTo: function(current, path, query) {
          window.location= '/users/auth/yahoo';
        }
      })
      // Tools
      .when('/tools', {
        templateUrl: "<%= asset_path('tools/index.html') %>",
        controller: 'ToolsIndexCtrl',
      })
      .when('/tools/new', {
        templateUrl: "<%= asset_path('tools/new.html') %>",
        controller: 'ToolsNewCtrl',
      })
      .when('/tools/:toolId', {
        templateUrl: "<%= asset_path('tools/detail.html') %>",
        controller: 'ToolsDetailCtrl',
      })
      // Users
      .when('/users', {
        templateUrl: "<%= asset_path('users/index.html') %>",
        controller: 'UsersIndexCtrl',
      })
      // Attributes
      .when('/attributes', {
        templateUrl: "<%= asset_path('attributes/index.html') %>",
        controller: 'AttributesIndexCtrl',
      })
      .when('/attributes/new', {
        templateUrl: "<%= asset_path('attributes/new.html') %>",
        controller: 'AttributesNewCtrl',
      })
  }]);


